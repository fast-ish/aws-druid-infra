indexLogs:
  name: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-indexlogs
  accessControl: bucket_owner_full_control
  objectOwnership: bucket_owner_enforced
  removalPolicy: destroy
  autoDeleteObjects: true
  bucketPolicies:
    - name: {{deployment:id}}-indexlogs
      policy: policy/bucket-access.mustache
      principals:
        - type: arn
          value: arn:aws:iam::{{deployment:account}}:role/{{deployment:id}}-{{deployment:eks:druid:release}}-druid-sa
      mappings:
        resources:
          - "arn:aws:s3:::{{deployment:id}}-{{deployment:eks:druid:release}}-druid-indexlogs/*"
          - "arn:aws:s3:::{{deployment:id}}-{{deployment:eks:druid:release}}-druid-indexlogs"
  lifecycleRules:
    - id: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-indexlogs-expiration
      expiration: 1
      enabled: true
  tags:
    "{{deployment:domain}}:resource-type": s3
    "{{deployment:domain}}:category": storage
    "{{deployment:domain}}:type": analytics
    "{{deployment:domain}}:component": {{deployment:id}}-druid-indexlogs
    "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"

deepStorage:
  name: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-deepstorage
  accessControl: bucket_owner_full_control
  objectOwnership: bucket_owner_enforced
  removalPolicy: destroy
  autoDeleteObjects: true
  bucketPolicies:
    - name: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-deepstorage
      policy: "policy/bucket-access.mustache"
      principals:
        - type: arn
          value: arn:aws:iam::{{deployment:account}}:role/{{deployment:id}}-{{deployment:eks:druid:release}}-druid-sa
      mappings:
        resources:
          - arn:aws:s3:::{{deployment:id}}-{{deployment:eks:druid:release}}-druid-deepstorage/*
          - arn:aws:s3:::{{deployment:id}}-{{deployment:eks:druid:release}}-druid-deepstorage
  lifecycleRules:
    - id: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-deepstorage-expiration
      expiration: 1
      enabled: true
  tags:
    "{{deployment:domain}}:resource-type": s3
    "{{deployment:domain}}:category": storage
    "{{deployment:domain}}:type": analytics
    "{{deployment:domain}}:component": {{deployment:id}}-druid-deepstorage
    "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"

multiStageQuery:
  name: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-msq
  accessControl: bucket_owner_full_control
  objectOwnership: bucket_owner_enforced
  removalPolicy: destroy
  autoDeleteObjects: true
  bucketPolicies:
    - name: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-deepstorage
      policy: policy/bucket-access.mustache
      principals:
        - type: arn
          value: arn:aws:iam::{{deployment:account}}:role/{{deployment:id}}-{{deployment:eks:druid:release}}-druid-sa
      mappings:
        resources:
          - arn:aws:s3:::{{deployment:id}}-{{deployment:eks:druid:release}}-druid-msq/*
          - arn:aws:s3:::{{deployment:id}}-{{deployment:eks:druid:release}}-druid-msq
  lifecycleRules:
    - id: "{{deployment:id}}-{{deployment:eks:druid:release}}-druid-msq-expiration"
      expiration: 1
      enabled: true
  tags:
    "{{deployment:domain}}:resource-type": s3
    "{{deployment:domain}}:category": storage
    "{{deployment:domain}}:type": analytics
    "{{deployment:domain}}:component": {{deployment:id}}-druid-multi-stage-query
    "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"

metadata:
  name: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-metadata
  credentials:
    name: {{deployment:id}}-{{deployment:eks:druid:release}}-druid-metadata
    description: "druid deep storage rds username & password"
    username: druid_metadata_admin
    password:
      length: 20
      excludeNumbers: true
      excludeLowercase: false
      excludeUppercase: false
      includeSpace: false
      requireEachIncludedType: true
    removalPolicy: destroy
  databaseName: druid_metadata
  version: 15.4
  storageType: aurora_iopt1
  writer:
    name: metadata-writer
    allowMajorVersionUpgrade: true
    autoMinorVersionUpgrade: true
    publiclyAccessible: false
    performanceInsights:
      enabled: true
      retention: default
  readers:
    - name: metadata-reader
      allowMajorVersionUpgrade: true
      autoMinorVersionUpgrade: true
      publiclyAccessible: false
      scaleWithWriter: true
      performanceInsights:
        enabled: true
        retention: default
  removalPolicy: destroy
  deletionProtection: false
  enableDataApi: true
  tags:
    "{{deployment:domain}}:resource-type": rds
    "{{deployment:domain}}:category": storage
    "{{deployment:domain}}:type": metadata
    "{{deployment:domain}}:component": {{deployment:id}}-druid-metadata
    "{{deployment:domain}}:part-of": "{{deployment:organization}}.{{deployment:team:name}}.{{deployment:team:alias}}"
